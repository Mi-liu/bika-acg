import{a0 as F,h as pe,e as Ie,f as q,bI as ze,_ as Ce,d as G,bJ as we,bK as Ae,bL as Be,a5 as Le,g as Ee,T as Me,p as y,bM as Ve,aI as Ye,c as m,x as me,Z as Se,aC as X,y as se,o as g,z as v,b as i,a6 as De,k as p,m as ye,n as f,u as e,a8 as Fe,j as k,a as C,r as B,J as $e,G as O,aa as Xe,F as ne,bN as He,bO as je,l as Ke,t as xe,bP as We,bQ as Ze,aL as qe,bR as Ge,bS as Je,C as Qe,a7 as Ue,ab as et,ac as tt,bT as ve,bU as at,aE as D,a2 as Ne,w as Oe,by as st,bV as nt,bW as ot,az as lt,a9 as he,bb as ke,bc as _e,bX as rt,ay as it,bY as ct,bZ as ut,b_ as dt}from"./index-Ck9RW2oE.js";import{E as ft,a as vt}from"./el-skeleton-item-D_gn3vta.js";import{g as pt}from"./scroll-DsdMwT4P.js";const mt=(u,E)=>{if(!F||!u||!E)return!1;const o=u.getBoundingClientRect();let s;return E instanceof Element?s=E.getBoundingClientRect():s={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},o.top<s.bottom&&o.bottom>s.top&&o.right>s.left&&o.left<s.right},gt=Ie({urlList:{type:q(Array),default:()=>ze([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:q(String)}}),bt={close:()=>!0,switch:u=>pe(u),rotate:u=>pe(u)},wt=G({name:"ElImageViewer"}),yt=G({...wt,props:gt,emits:bt,setup(u,{expose:E,emit:o}){var s;const l=u,b={CONTAIN:{name:"contain",icon:we(Be)},ORIGINAL:{name:"original",icon:we(Ae)}};let Y,_="";const{t:H}=Le(),n=Ee("image-viewer"),{nextZIndex:N}=Me(),I=y(),R=y([]),M=Ve(),w=y(!0),h=y(l.initialIndex),T=Ye(b.CONTAIN),c=y({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),oe=y((s=l.zIndex)!=null?s:N()),j=m(()=>{const{urlList:t}=l;return t.length<=1}),J=m(()=>h.value===0),K=m(()=>h.value===l.urlList.length-1),W=m(()=>l.urlList[h.value]),le=m(()=>[n.e("btn"),n.e("prev"),n.is("disabled",!l.infinite&&J.value)]),re=m(()=>[n.e("btn"),n.e("next"),n.is("disabled",!l.infinite&&K.value)]),Q=m(()=>{const{scale:t,deg:d,offsetX:r,offsetY:L,enableTransition:$}=c.value;let x=r/t,A=L/t;const Z=d*Math.PI/180,ge=Math.cos(Z),be=Math.sin(Z);x=x*ge+A*be,A=A*ge-r/t*be;const fe={transform:`scale(${t}) rotate(${d}deg) translate(${x}px, ${A}px)`,transition:$?"transform .3s":""};return T.value.name===b.CONTAIN.name&&(fe.maxWidth=fe.maxHeight="100%"),fe}),U=m(()=>`${h.value+1} / ${l.urlList.length}`);function V(){te(),Y==null||Y(),document.body.style.overflow=_,o("close")}function ee(){const t=ve(r=>{switch(r.code){case D.esc:l.closeOnPressEscape&&V();break;case D.space:S();break;case D.left:ue();break;case D.up:P("zoomIn");break;case D.right:de();break;case D.down:P("zoomOut");break}}),d=ve(r=>{const L=r.deltaY||r.deltaX;P(L<0?"zoomIn":"zoomOut",{zoomRate:l.zoomRate,enableTransition:!1})});M.run(()=>{X(document,"keydown",t),X(document,"wheel",d)})}function te(){M.stop()}function ie(){w.value=!1}function ce(t){w.value=!1,t.target.alt=H("el.image.error")}function a(t){if(w.value||t.button!==0||!I.value)return;c.value.enableTransition=!1;const{offsetX:d,offsetY:r}=c.value,L=t.pageX,$=t.pageY,x=ve(Z=>{c.value={...c.value,offsetX:d+Z.pageX-L,offsetY:r+Z.pageY-$}}),A=X(document,"mousemove",x);X(document,"mouseup",()=>{A()}),t.preventDefault()}function z(){c.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function S(){if(w.value)return;const t=at(b),d=Object.values(b),r=T.value.name,$=(d.findIndex(x=>x.name===r)+1)%t.length;T.value=b[t[$]],z()}function ae(t){const d=l.urlList.length;h.value=(t+d)%d}function ue(){J.value&&!l.infinite||ae(h.value-1)}function de(){K.value&&!l.infinite||ae(h.value+1)}function P(t,d={}){if(w.value)return;const{minScale:r,maxScale:L}=l,{zoomRate:$,rotateDeg:x,enableTransition:A}={zoomRate:l.zoomRate,rotateDeg:90,enableTransition:!0,...d};switch(t){case"zoomOut":c.value.scale>r&&(c.value.scale=Number.parseFloat((c.value.scale/$).toFixed(3)));break;case"zoomIn":c.value.scale<L&&(c.value.scale=Number.parseFloat((c.value.scale*$).toFixed(3)));break;case"clockwise":c.value.deg+=x,o("rotate",c.value.deg);break;case"anticlockwise":c.value.deg-=x,o("rotate",c.value.deg);break}c.value.enableTransition=A}function Re(t){var d;((d=t.detail)==null?void 0:d.focusReason)==="pointer"&&t.preventDefault()}function Te(){l.closeOnPressEscape&&V()}function Pe(t){if(t.ctrlKey){if(t.deltaY<0)return t.preventDefault(),!1;if(t.deltaY>0)return t.preventDefault(),!1}}return me(W,()=>{Ne(()=>{const t=R.value[0];t!=null&&t.complete||(w.value=!0)})}),me(h,t=>{z(),o("switch",t)}),Se(()=>{ee(),Y=X("wheel",Pe,{passive:!1}),_=document.body.style.overflow,document.body.style.overflow="hidden"}),E({setActiveItem:ae}),(t,d)=>(g(),se(e(tt),{to:"body",disabled:!t.teleported},{default:v(()=>[i(De,{name:"viewer-fade",appear:""},{default:v(()=>[p("div",{ref_key:"wrapper",ref:I,tabindex:-1,class:f(e(n).e("wrapper")),style:ye({zIndex:oe.value})},[i(e(Fe),{loop:"",trapped:"","focus-trap-el":I.value,"focus-start-el":"container",onFocusoutPrevented:Re,onReleaseRequested:Te},{default:v(()=>[p("div",{class:f(e(n).e("mask")),onClick:$e(r=>t.hideOnClickModal&&V(),["self"])},null,10,["onClick"]),k(" CLOSE "),p("span",{class:f([e(n).e("btn"),e(n).e("close")]),onClick:V},[i(e(O),null,{default:v(()=>[i(e(Xe))]),_:1})],2),k(" ARROW "),e(j)?k("v-if",!0):(g(),C(ne,{key:0},[p("span",{class:f(e(le)),onClick:ue},[i(e(O),null,{default:v(()=>[i(e(He))]),_:1})],2),p("span",{class:f(e(re)),onClick:de},[i(e(O),null,{default:v(()=>[i(e(je))]),_:1})],2)],64)),t.$slots.progress||t.showProgress?(g(),C("div",{key:1,class:f([e(n).e("btn"),e(n).e("progress")])},[B(t.$slots,"progress",{activeIndex:h.value,total:t.urlList.length},()=>[Ke(xe(e(U)),1)])],2)):k("v-if",!0),k(" ACTIONS "),p("div",{class:f([e(n).e("btn"),e(n).e("actions")])},[p("div",{class:f(e(n).e("actions__inner"))},[B(t.$slots,"toolbar",{actions:P,prev:ue,next:de,reset:S,activeIndex:h.value,setActiveItem:ae},()=>[i(e(O),{onClick:r=>P("zoomOut")},{default:v(()=>[i(e(We))]),_:1},8,["onClick"]),i(e(O),{onClick:r=>P("zoomIn")},{default:v(()=>[i(e(Ze))]),_:1},8,["onClick"]),p("i",{class:f(e(n).e("actions__divider"))},null,2),i(e(O),{onClick:S},{default:v(()=>[(g(),se(qe(e(T).icon)))]),_:1}),p("i",{class:f(e(n).e("actions__divider"))},null,2),i(e(O),{onClick:r=>P("anticlockwise")},{default:v(()=>[i(e(Ge))]),_:1},8,["onClick"]),i(e(O),{onClick:r=>P("clockwise")},{default:v(()=>[i(e(Je))]),_:1},8,["onClick"])])],2)],2),k(" CANVAS "),p("div",{class:f(e(n).e("canvas"))},[(g(!0),C(ne,null,Qe(t.urlList,(r,L)=>Ue((g(),C("img",{ref_for:!0,ref:$=>R.value[L]=$,key:r,src:r,style:ye(e(Q)),class:f(e(n).e("img")),crossorigin:t.crossorigin,onLoad:ie,onError:ce,onMousedown:a},null,46,["src","crossorigin"])),[[et,L===h.value]])),128))],2),B(t.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ht=Ce(yt,[["__file","image-viewer.vue"]]);const kt=Oe(ht),_t=Ie({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:q([String,Object])},previewSrcList:{type:q(Array),default:()=>ze([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:q(String)}}),It={load:u=>u instanceof Event,error:u=>u instanceof Event,switch:u=>pe(u),close:()=>!0,show:()=>!0},zt=G({name:"ElImage",inheritAttrs:!1}),Ct=G({...zt,props:_t,emits:It,setup(u,{expose:E,emit:o}){const s=u,{t:l}=Le(),b=Ee("image"),Y=st(),_=m(()=>nt(Object.entries(Y).filter(([a])=>/^(data-|on[A-Z])/i.test(a)||["id","style"].includes(a)))),H=ot({excludeListeners:!0,excludeKeys:m(()=>Object.keys(_.value))}),n=y(),N=y(!1),I=y(!0),R=y(!1),M=y(),w=y(),h=F&&"loading"in HTMLImageElement.prototype;let T;const c=m(()=>[b.e("inner"),j.value&&b.e("preview"),I.value&&b.is("loading")]),oe=m(()=>{const{fit:a}=s;return F&&a?{objectFit:a}:{}}),j=m(()=>{const{previewSrcList:a}=s;return lt(a)&&a.length>0}),J=m(()=>{const{previewSrcList:a,initialIndex:z}=s;let S=z;return z>a.length-1&&(S=0),S}),K=m(()=>s.loading==="eager"?!1:!h&&s.loading==="lazy"||s.lazy),W=()=>{F&&(I.value=!0,N.value=!1,n.value=s.src)};function le(a){I.value=!1,N.value=!1,o("load",a)}function re(a){I.value=!1,N.value=!0,o("error",a)}function Q(){mt(M.value,w.value)&&(W(),ee())}const U=ct(Q,200,!0);async function V(){var a;if(!F)return;await Ne();const{scrollContainer:z}=s;rt(z)?w.value=z:it(z)&&z!==""?w.value=(a=document.querySelector(z))!=null?a:void 0:M.value&&(w.value=pt(M.value)),w.value&&(T=X(w,"scroll",U),setTimeout(()=>Q(),100))}function ee(){!F||!w.value||!U||(T==null||T(),w.value=void 0)}function te(){j.value&&(R.value=!0,o("show"))}function ie(){R.value=!1,o("close")}function ce(a){o("switch",a)}return me(()=>s.src,()=>{K.value?(I.value=!0,N.value=!1,ee(),V()):W()}),Se(()=>{K.value?V():W()}),E({showPreview:te}),(a,z)=>(g(),C("div",he({ref_key:"container",ref:M},e(_),{class:[e(b).b(),a.$attrs.class]}),[N.value?B(a.$slots,"error",{key:0},()=>[p("div",{class:f(e(b).e("error"))},xe(e(l)("el.image.error")),3)]):(g(),C(ne,{key:1},[n.value!==void 0?(g(),C("img",he({key:0},e(H),{src:n.value,loading:a.loading,style:e(oe),class:e(c),crossorigin:a.crossorigin,onClick:te,onLoad:le,onError:re}),null,16,["src","loading","crossorigin"])):k("v-if",!0),I.value?(g(),C("div",{key:1,class:f(e(b).e("wrapper"))},[B(a.$slots,"placeholder",{},()=>[p("div",{class:f(e(b).e("placeholder"))},null,2)])],2)):k("v-if",!0)],64)),e(j)?(g(),C(ne,{key:2},[R.value?(g(),se(e(kt),{key:0,"z-index":a.zIndex,"initial-index":e(J),infinite:a.infinite,"zoom-rate":a.zoomRate,"min-scale":a.minScale,"max-scale":a.maxScale,"show-progress":a.showProgress,"url-list":a.previewSrcList,crossorigin:a.crossorigin,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:ie,onSwitch:ce},{progress:v(S=>[B(a.$slots,"progress",ke(_e(S)))]),toolbar:v(S=>[B(a.$slots,"toolbar",ke(_e(S)))]),default:v(()=>[a.$slots.viewer?(g(),C("div",{key:0},[B(a.$slots,"viewer")])):k("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):k("v-if",!0)],64)):k("v-if",!0)],16))}});var Lt=Ce(Ct,[["__file","image.vue"]]);const Et=Oe(Lt),St={key:1,class:"absolute inset-0 flex-center"},$t={class:"absolute inset-0 flex-center bg-[--el-fill-color]"},Rt=G({__name:"index",props:{src:{default:""},aspect:{default:"3/4"}},setup(u){const E=u,o=y("");ut(()=>{o.value=E.src});const s=y("loading"),l=m(()=>s.value==="load"?`aspect-${E.aspect}`:"aspect-3/4");function b(){s.value="loading",o.value=`${o.value}?t=${Date.now()}`}return(Y,_)=>{const H=Et,n=vt,N=ft,I=O;return g(),C("div",{class:f(["relative bg-[--el-fill-color]",[e(l)]])},[e(o).length?(g(),se(H,{key:0,class:f(["w-full vertical-top",[e(l)]]),src:e(o),fit:"cover",loading:"lazy",onLoad:_[0]||(_[0]=R=>s.value="load"),onError:_[1]||(_[1]=R=>s.value="error")},{error:v(()=>[p("div",{class:"aspect-3/4 flex-col flex-center cursor-pointer text-[--el-text-color-secondary]",onClick:$e(b,["stop"])},_[2]||(_[2]=[p("div",null,"加载失败",-1),p("div",null,"点击重新加载",-1)]))]),_:1},8,["class","src"])):k("",!0),e(s)==="loading"?(g(),C("div",St,[i(N,{class:"size-full",loading:!0,animated:""},{template:v(()=>[i(n,{class:"size-full!",variant:"image"})]),_:1})])):k("",!0),p("div",$t,[i(I,null,{default:v(()=>[i(e(dt))]),_:1})])],2)}}});export{Rt as _};
