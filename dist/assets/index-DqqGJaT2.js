import{e as ne,be as ae,_ as ie,d as H,p as N,al as re,g as ce,c as V,ak as F,by as de,Z as ue,an as pe,y as _,o as n,z as i,r as fe,m as _e,n as me,u as l,aL as ve,w as xe,q as he,aR as ge,s as Ce,aS as ke,v as ye,a as f,k as a,b as s,t as y,aX as we,F as L,C as A,bz as be,N as Ee,bm as Te,A as Se,aG as Le,bA as U,J as w,G as Ae,bB as Re,aq as Ie,j as ze,l as h,E as Be,K as $e,aY as D,bC as He,bD as Oe,O as Pe}from"./index-Bvg3xOz3.js";import{E as We}from"./el-tag-DJBzkWE8.js";import{E as Fe}from"./el-popover-Drzf6kJ5.js";import"./el-tooltip-l0sNRNKZ.js";import{E as Ue,a as De}from"./el-skeleton-item-PgMafNQ2.js";import{E as Me,a as Ne}from"./el-select-CrmS-k0g.js";import{_ as Ve,D as M,c as qe}from"./cardAnimation-CqsRZNrr.js";import{_ as Ge}from"./index.vue_vue_type_script_setup_true_lang-CSYbAmhe.js";import{E as je}from"./el-message-box-DhPe5-1U.js";import"./el-overlay-C7cVmnoe.js";const Ke=ne({type:{type:String,values:["primary","success","info","warning","danger",""],default:""},size:{type:String,values:ae,default:""},truncated:Boolean,lineClamp:{type:[String,Number]},tag:{type:String,default:"span"}}),Ze=H({name:"ElText"}),Je=H({...Ze,props:Ke,setup($){const p=$,u=N(),b=re(),c=ce("text"),R=V(()=>[c.b(),c.m(p.type),c.m(b.value),c.is("truncated",p.truncated),c.is("line-clamp",!F(p.lineClamp))]),g=de().title,C=()=>{var d,E,I,T,z;if(g)return;let S=!1;const k=((d=u.value)==null?void 0:d.textContent)||"";if(p.truncated){const m=(E=u.value)==null?void 0:E.offsetWidth,v=(I=u.value)==null?void 0:I.scrollWidth;m&&v&&v>m&&(S=!0)}else if(!F(p.lineClamp)){const m=(T=u.value)==null?void 0:T.offsetHeight,v=(z=u.value)==null?void 0:z.scrollHeight;m&&v&&v>m&&(S=!0)}S?u.value.setAttribute("title",k):u.value.removeAttribute("title")};return ue(C),pe(C),(d,E)=>(n(),_(ve(d.tag),{ref_key:"textRef",ref:u,class:me(l(R)),style:_e({"-webkit-line-clamp":d.lineClamp})},{default:i(()=>[fe(d.$slots,"default")]),_:3},8,["class","style"]))}});var Xe=ie(Je,[["__file","text.vue"]]);const Ye=xe(Xe),Qe={class:"comic-list size-full flex-1 flex flex-col"},et={class:"flex px py"},tt={class:"size-full flex justify-between"},ot={class:"text-18px"},lt={class:"h-full flex-1 overflow-hidden"},st={key:0,class:"card-animation-grid card-grid-custom",style:{"grid-template-columns":"repeat(auto-fill, 270px)",gap:"20px"}},nt={class:"size-full"},at={class:"w-full! aspect-3/4"},it={class:"mt-2 flex gap-2"},rt=["onClick"],ct={class:"relative"},dt=["onClick"],ut=["onClick"],pt={class:"line-clamp-2 text-16px font-500 mt-2"},ft={class:"text-13px mt-1 text-[--el-text-color-secondary]"},_t={class:"text-14px text-[--el-text-color-secondary] flex"},mt={class:"flex-1 flex gap-2 ml-2 flex-wrap"},vt={class:"w-full flex flex-col"},xt={class:"mt-2 flex flex-wrap gap-2"},ht=H({__name:"index",props:{title:{},isBlockedCategories:{type:Boolean,default:!0},params:{},fetch:{}},setup($){const p=$,u=he(),b=ge(),c=Ce(),R=ke("CommonPaginationRef"),g=N(Oe),{loading:C,data:d,run:E}=ye(e=>p.fetch(e),{manual:!0,initialData:{docs:[],total:0,page:1,pages:0,limit:M},onError:e=>{console.error("获取漫画列表失败:",e)}});function I(){var e;(e=R.value)==null||e.reset()}function T(e){d.value&&(d.value.docs=[]),E({page:e.currentPage,s:g.value,...p.params})}T({currentPage:1});const z=V(()=>d.value?p.isBlockedCategories?d.value.docs.filter(e=>!e.categories.some(t=>b.comic.blockedCategories.includes(t))):d.value.docs:[]);async function S(e){await je.alert(`是否屏蔽分类：${e}`,"提示",{showCancelButton:!0}),b.comic.blockedCategories.includes(e)?D.warning("分类已被屏蔽，请勿重复添加"):(b.comic.blockedCategories.push(e),D.success("分类已被屏蔽"))}const k=qe.leftToRight;function m(e){const t=u.resolve(`/comic/detail/${e._id}`).href;window.open(t,"_blank")}function v(e){const t=u.resolve({path:"/comic/list",query:{author:e}}).href;window.open(t,"_blank")}function q(e){c.pushItem("FOLLOW_AUTHOR_LIST",e)}function G(e){c.removeItem("FOLLOW_AUTHOR_LIST",e)}function j(e){c.pushItem("WATCH_LATER_LIST",He(e))}function K(e){c.removeItem("WATCH_LATER_LIST",e,"_id")}function Z(e){const t=u.resolve({path:"/comic/list",query:{title:e}}).href;window.open(t,"_blank")}return(e,t)=>{var W;const J=Ne,X=Me,x=De,Y=Ue,O=Ae,Q=Le,ee=Ye,te=$e,P=Be,oe=Fe,le=We,se=Ee;return n(),f("div",Qe,[a("div",et,[a("div",tt,[a("div",ot,y(p.title||"漫画列表"),1),s(X,{modelValue:l(g),"onUpdate:modelValue":t[0]||(t[0]=o=>we(g)?g.value=o:null),class:"w-110px!",disabled:l(C),onChange:I},{default:i(()=>[(n(!0),f(L,null,A(l(be),o=>(n(),_(J,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),s(Ve,{ref_key:"CommonPaginationRef",ref:R,total:((W=l(d))==null?void 0:W.total)||0,layout:"slot, ->, total, prev, pager, next, jumper","page-size":l(M),disabled:l(C),onChange:T},null,8,["total","page-size","disabled"])]),a("div",lt,[s(se,{height:"100%"},{default:i(()=>[t[5]||(t[5]=a("div",{class:"w-full h-6px"},null,-1)),l(C)?(n(),f("div",st,[(n(),f(L,null,A(12,o=>s(Y,{key:o,class:"rounded-2 overflow-hidden p-3 shadow-[--el-box-shadow]",loading:!0},{template:i(()=>[a("div",nt,[a("div",at,[s(x,{class:"size-full!",variant:"image"})]),s(x,{variant:"h3",class:"w-80%! mt-2"}),s(x,{variant:"text",class:"w-60%! mt-1"}),s(x,{variant:"text",class:"w-40%! mt-1"}),a("div",it,[s(x,{variant:"button",class:"w-50px! h-24px!"}),s(x,{variant:"button",class:"w-60px! h-24px!"}),s(x,{variant:"button",class:"w-40px! h-24px!"})])])]),_:2},1024)),64))])):(n(),_(Te,{key:1,tag:"div",class:"card-animation-grid card-grid-custom",style:{"grid-template-columns":"repeat(auto-fill, 270px)",gap:"20px"},css:!1,onBeforeEnter:l(k).onBeforeEnter,onEnter:l(k).onEnter,onLeave:l(k).onLeave,onMove:l(k).onMove},{default:i(()=>[(n(!0),f(L,null,A(l(z),o=>(n(),f("div",{key:o._id,class:"rounded-2 overflow-hidden cursor-pointer p-3 shadow-[--el-box-shadow]",onClick:r=>m(o)},[a("div",ct,[s(Ge,{src:l(Se)(o.thumb.path)},null,8,["src"]),s(Q,{class:"box-item",effect:"dark",content:l(U)(l(c).local.WATCH_LATER_LIST,o._id,"_id")?"从稍后再看中移除":"添加到稍后再看",placement:"top-start"},{default:i(()=>[l(U)(l(c).local.WATCH_LATER_LIST,o._id,"_id")?(n(),f("div",{key:1,class:"absolute top-2 right-2 w-30px h-30px bg-[--el-color-info] rounded-1 flex-center",onClick:w(r=>K(o),["stop"])},[s(O,{class:"text-[--el-color-white]!"},{default:i(()=>[s(l(Ie))]),_:1})],8,ut)):(n(),f("div",{key:0,class:"absolute top-2 right-2 w-30px h-30px bg-[--el-color-info] rounded-1 flex-center",onClick:w(r=>j(o),["stop"])},[s(O,{class:"text-[--el-color-white]!"},{default:i(()=>[s(l(Re))]),_:1})],8,dt))]),_:2},1032,["content"])]),a("div",pt,y(o.title),1),a("div",ft,[o.finished?(n(),_(ee,{key:0,class:"mx-1",type:"primary"},{default:i(()=>t[1]||(t[1]=[h("[完结]")])),_:1})):ze("",!0),h(" "+y(o.epsCount)+"章 共 "+y(o.pagesCount)+"P ",1)]),a("div",_t,[t[4]||(t[4]=h(" 作者: ")),a("div",mt,[(n(!0),f(L,null,A(o.author.split(/[、,，]\s*/),r=>(n(),_(oe,{key:r,width:"70px"},{reference:i(()=>[s(te,{type:"primary",underline:"always",onClick:w(B=>v(r),["stop"])},{default:i(()=>[h(y(r),1)]),_:2},1032,["onClick"])]),default:i(()=>[a("div",vt,[l(c).local.FOLLOW_AUTHOR_LIST.includes(r)?(n(),_(P,{key:0,class:"w-full",type:"danger",size:"default",onClick:w(B=>G(r),["stop"])},{default:i(()=>t[2]||(t[2]=[h(" 取消关注 ")])),_:2},1032,["onClick"])):(n(),_(P,{key:1,class:"w-full",type:"primary",size:"default",onClick:w(B=>q(r),["stop"])},{default:i(()=>t[3]||(t[3]=[h(" 关注 ")])),_:2},1032,["onClick"]))])]),_:2},1024))),128))])]),a("div",xt,[(n(!0),f(L,null,A(o.categories,r=>(n(),_(le,{key:r,closable:"",type:"primary",effect:"plain",onClose:B=>S(r),onClick:w(B=>Z(r),["stop"])},{default:i(()=>[h(y(r),1)]),_:2},1032,["onClose","onClick"]))),128))])],8,rt))),128))]),_:1},8,["onBeforeEnter","onEnter","onLeave","onMove"])),t[6]||(t[6]=a("div",{class:"w-full h-6px"},null,-1))]),_:1})])])}}}),At=Pe(ht,[["__scopeId","data-v-2d0c8835"]]);export{At as C};
