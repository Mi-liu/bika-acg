import{a as oe,p as le,b as se,g as ne,_ as re}from"./index-GoDgw8E1.js";/* empty css                   *//* empty css                     */import"./el-tooltip-l0sNRNKZ.js";/* empty css               *//* empty css                  */import{_ as ie}from"./index.vue_vue_type_script_setup_true_lang-C8WYWAyV.js";import{t as de,aw as ce,r as F,U as N,c as $,e as ue,v as c,x as i,G as r,L as l,E as C,O as k,u as t,a2 as m,J as n,P as me,F as S,af as I,I as P,M as pe,h as ge}from"./vue-vendor-Ca7P3bJW.js";import{F as fe,L as _e}from"./icons-CYK57vyT.js";import{d as xe}from"./vue-hooks-plus-DBdGNJzO.js";import{c as he}from"./comic-CGO78TYS.js";import{u as be}from"./vueuse-BNhGQrOH.js";import{f as ve,n as ye,q as Ee,r as Ce,s as Le,t as Ne,u as we,v as Ve,w as ke,x as Se,y as Ie,z as Pe,E as Re}from"./element-plus-DvbWlh34.js";import{o as Me}from"./utils-Rmfb0WWx.js";/* empty css                         */const Oe={class:"flex flex-col bg-[--el-text-color-primary] h-screen"},Ue={class:"h-50px flex justify-between items-center p-3 bg-[--el-color-black] color-[--el-color-white] border-b"},De={class:"flex items-center gap-3"},Be={class:"font-medium"},He={class:"text-sm opacity-75"},Te={key:0,class:"text-sm text-blue-400 flex items-center gap-1"},je={key:1,class:"text-sm text-red-400 flex items-center gap-1"},Fe={class:"flex items-center gap-2"},$e={key:0,class:"text-center py-4"},ze={key:1,class:"text-center py-4"},We={class:"size-full"},Qe={key:0,class:"text-xs text-gray-400 mt-1"},qe={key:0,class:"text-xs text-gray-400 mt-1"},Ge=50,Ae=2,Je=de({__name:"chapter",props:{id:{},chapter:{},maxChapter:{}},setup(z){const w=z,d=oe(),R=ce("scrollbarRef"),W=window.innerWidth,Q=window.innerHeight,f=F(Number(w.chapter)),M=Number(w.maxChapter),L=N({}),p=N({page:1,pages:1,total:1,limit:40}),_=F(!1),v=N([]),o=N({isLoadingNextPage:!1,hasError:!1,errorMessage:""});async function x(s,e=!1){if(!o.isLoadingNextPage)try{o.isLoadingNextPage=!0,o.hasError=!1;const u=s||p.page+1,g=await he(w.id,f.value,u,e);Object.assign(L,g.ep),Object.assign(p,Me(g.pages,"docs"));const y=g.pages.docs.map(h=>({id:h.id,path:ne(h.media.path)}));v.push(...y)}catch(u){console.error("章节数据加载失败:",u),o.hasError=!0,o.errorMessage="章节数据加载失败，请稍后重试",Re.error(o.errorMessage)}finally{o.isLoadingNextPage=!1}}const q=xe(s=>{var E;const e=(E=R.value)==null?void 0:E.wrapRef;if(!e)return;const{scrollTop:u}=s,{scrollHeight:g,clientHeight:y}=e,h=g-u-y,V=Q*Ae;h<=V&&p.page<p.pages&&!o.isLoadingNextPage&&x()},Ge);function O(){v.length=0,Object.keys(L).forEach(s=>{delete L[s]}),Object.assign(p,{page:1,pages:1,total:1,limit:40}),o.hasError=!1,o.errorMessage="",o.isLoadingNextPage=!1}const U=$(()=>f.value>1),D=$(()=>f.value<M);function G(){U.value&&(O(),f.value=f.value-1,x(1))}function A(){D.value&&(O(),f.value=f.value+1,x(1))}function J(){o.hasError=!1,o.errorMessage="",x(1)}function B(s=!1){v.length=0,Object.assign(p,{page:1,pages:1,total:1,limit:40}),o.hasError=!1,o.errorMessage="",x(1,s)}function Y(s){console.log(`画质已更改为 ${s}，强制重新加载章节数据`),B(!0)}function K(s){console.log(`线路代理已更改为 ${(s==null?void 0:s.label)||s}，强制重新加载章节数据`),B(!0)}function H(s){s.stopPropagation(),s.preventDefault(),_.value=!_.value}return ue(()=>{be(document.querySelector(".chapter-drawer-modal"),"contextmenu",H)}),x(1),(s,e)=>{const u=ve,g=ye,y=ie,h=Ee,V=Ne,b=Le,E=Ve,T=we,X=Se,Z=ke,ee=Ie,te=Ce,ae=Pe;return i(),c("div",Oe,[r("div",Ue,[r("div",De,[r("div",Be,k(t(L).title||"加载中..."),1),r("div",He,"共"+k(t(M))+"章",1),t(o).isLoadingNextPage?(i(),c("div",Te,e[7]||(e[7]=[r("span",{class:"animate-spin"},"⏳",-1),m(" 加载中... ")]))):C("",!0),t(o).hasError?(i(),c("div",je,[e[9]||(e[9]=r("span",null,"❌",-1)),e[10]||(e[10]=m(" 加载失败 ")),l(u,{size:"small",text:"",onClick:J},{default:n(()=>e[8]||(e[8]=[m("重试")])),_:1})])):C("",!0)]),r("div",Fe,[l(u,{disabled:!t(U),text:"",bg:"",onClick:G},{default:n(()=>e[11]||(e[11]=[m(" 上一章 ")])),_:1},8,["disabled"]),l(u,{disabled:!t(D),text:"",bg:"",onClick:A},{default:n(()=>e[12]||(e[12]=[m(" 下一章 ")])),_:1},8,["disabled"]),l(g,{class:"cursor-pointer hover:text-blue-300 ml-2",onClick:e[0]||(e[0]=a=>_.value=!0)},{default:n(()=>[l(t(fe))]),_:1})])]),r("div",{class:"flex-1 overflow-hidden",onContextmenu:pe(H,["prevent"])},[l(h,{ref_key:"scrollbarRef",ref:R,class:"h-full",onScroll:t(q)},{default:n(()=>[r("div",{class:"mx-auto",style:me({width:`${t(d).comic.comicImageWidth}px`})},[(i(!0),c(S,null,I(t(v),(a,j)=>(i(),P(y,{key:a.id||j,src:a.path,aspect:"auto",alt:`第${j+1}张图片`},null,8,["src","alt"]))),128)),t(o).isLoadingNextPage?(i(),c("div",$e,e[13]||(e[13]=[r("span",{class:"text-gray-500"},"正在加载更多图片...",-1)]))):t(p).page>=t(p).pages&&t(v).length>0?(i(),c("div",ze,e[14]||(e[14]=[r("span",{class:"text-gray-500"},"已加载全部图片",-1)]))):C("",!0)],4)]),_:1},8,["onScroll"])],32),l(ae,{modelValue:t(_),"onUpdate:modelValue":e[6]||(e[6]=a=>ge(_)?_.value=a:null),"modal-class":"chapter-drawer-modal",direction:"rtl",size:"400px","with-header":!1},{default:n(()=>[r("div",We,[l(te,{"label-width":"100px","label-position":"left"},{default:n(()=>[l(b,{label:"宽度"},{default:n(()=>[l(V,{modelValue:t(d).comic.comicImageWidth,"onUpdate:modelValue":e[1]||(e[1]=a=>t(d).comic.comicImageWidth=a),min:300,max:t(W),step:10},null,8,["modelValue","max"])]),_:1}),l(b,{label:"画质"},{default:n(()=>[l(T,{modelValue:t(d).comic.imageQuality,"onUpdate:modelValue":e[2]||(e[2]=a=>t(d).comic.imageQuality=a),placeholder:"请选择画质",loading:t(o).isLoadingNextPage,onChange:Y},{default:n(()=>[(i(!0),c(S,null,I(t(le),a=>(i(),P(E,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"]),t(o).isLoadingNextPage?(i(),c("div",Qe," 正在切换画质，重新加载图片... ")):C("",!0)]),_:1}),l(b,{label:"自动阅读"},{label:n(({label:a})=>[m(k(a)+" ",1),l(X,{placement:"top"},{content:n(()=>e[15]||(e[15]=[m(" [开发中]自动下滑阅读，解放双手，且当前章节完成后会默认阅读下一章 "),r("br",null,null,-1),m("建议网速较好的情况下使用 "),r("br",null,null,-1),m("无忧无虑的冲吧~少年/女 ")])),default:n(()=>[l(g,{class:"ml-1 cursor-pointer"},{default:n(()=>[l(t(_e))]),_:1})]),_:1})]),default:n(()=>[l(Z,{modelValue:t(d).comic.autoRead,"onUpdate:modelValue":e[3]||(e[3]=a=>t(d).comic.autoRead=a)},null,8,["modelValue"])]),_:1}),l(b,{label:"自动阅读速度"},{default:n(()=>[l(ee,{modelValue:t(d).comic.autoReadSpeed,"onUpdate:modelValue":e[4]||(e[4]=a=>t(d).comic.autoReadSpeed=a),min:1,max:1e3,step:1},null,8,["modelValue"])]),_:1}),l(b,{label:"线路代理"},{default:n(()=>[l(T,{modelValue:t(d).comic.proxy,"onUpdate:modelValue":e[5]||(e[5]=a=>t(d).comic.proxy=a),"value-key":"api",placeholder:"请选择线路代理",onChange:K},{default:n(()=>[(i(!0),c(S,null,I(t(se),a=>(i(),P(E,{key:a.label,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),t(o).isLoadingNextPage?(i(),c("div",qe," 正在切换线路，重新加载图片... ")):C("",!0)]),_:1})]),_:1})])]),_:1},8,["modelValue"])])}}}),ut=re(Je,[["__scopeId","data-v-d0d4c5f9"]]);export{ut as default};
